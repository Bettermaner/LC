# ç»™ä½ ä¸€ä¸ªåªåŒ…å« '(' å’Œ ')' çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿æœ‰æ•ˆï¼ˆæ ¼å¼æ­£ç¡®ä¸”è¿žç»­ï¼‰æ‹¬å·å­ä¸²çš„é•¿åº¦ã€‚

# è¾“å…¥ï¼šs = ")()())"
# è¾“å‡ºï¼š4
# è§£é‡Šï¼šæœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²æ˜¯ "()()"

# æ–¹æ³•	æ—¶é—´å¤æ‚åº¦	ç©ºé—´å¤æ‚åº¦
# è§£æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’	O(n)	O(n)
# è§£æ³•äºŒï¼šæ ˆ	O(n)	O(n)
# è§£æ³•ä¸‰ï¼šåŒå‘éåŽ†	O(n)	O(1)

# è§£æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’
# è§£é¢˜æ€è·¯
     # åŠ¨æ€è§„åˆ’

    # é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª dp æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ ii ä¸ªå…ƒç´ è¡¨ç¤ºä»¥ä¸‹æ ‡ä¸º ii çš„å­—ç¬¦ç»“å°¾çš„æœ€é•¿è¿žç»­æœ‰æ•ˆå­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚
    # çŠ¶æ€è½¬ç§»æ–¹ç¨‹
    # if s[i] = "(",åˆ™dp[i] = 0,å› ä¸ºä¸å¯èƒ½æœ‰ä»¥"("ç»“å°¾çš„æ‹¬å·
    # if s[i] = ")" and s[i-1] = "(", åˆ™dp[i] = dp[i-2] + 2 
    
    # if s[i] = ")" and s[i-1] = ")"  and s[i-1 - dp[i-1]] = "("
    # å› ä¸ºä¸€æ—¦s[i]å’Œå·¦è¾¹çš„â€œï¼ˆâ€é…å¯¹åŽï¼Œå°±æˆäº†ä¸€ä¸ªå•ç‹¬çš„æ‹¬å·ï¼Œå¯èƒ½ä¸Žå·¦è¾¹çš„å­—ç¬¦ç»„æˆè¿žç»­æ‹¬å·,æ‰€ä»¥éœ€è¦ + dp[i-1- dp[i-1] - 1]
    # åˆ™ dp[i] = dp[i-1] + 2 + dp[i-1- dp[i-1] - 1]


def func(s):
    n = len(s)
    res = 0
    dp = [0 for i in range(n)]
    for i in range(1,n):
        if s[i] == "(":
            dp[i] = 0
        elif s[i] == ")":
            if s[i-1] == '(':
                dp[i] = dp[i -2] + 2
            elif s[i-1] == ")" and i-1 - dp[i-1] >= 0 and s[i-1 -dp[i-1]] == "(":
                dp[i] = dp[i -1] + 2 + dp[i-1-dp[i-1] -1 ]
        res = max(res,dp[i])

    return res

print(func("()(()())"))



# ðŸ§  è§£æ³•äºŒï¼šä½¿ç”¨ æ ˆï¼ˆStackï¼‰
# ðŸ’¡ æ€è·¯
# ä½¿ç”¨æ ˆæ¥è®°å½•å·¦æ‹¬å·çš„ä½ç½®ç´¢å¼•ã€‚å¹¶ç”¨ä¸€ä¸ªå˜é‡ start æ¥è®°å½•æ— æ•ˆå³æ‹¬å·çš„ä½ç½®æˆ–ä¸Šä¸€ä¸ªä¸åŒ¹é…çš„ä½ç½®ã€‚

# é‡åˆ° '('ï¼Œå°†å®ƒçš„ä¸‹æ ‡åŽ‹å…¥æ ˆ
# é‡åˆ° ')'ï¼š
# å¦‚æžœæ ˆä¸ºç©ºï¼Œè¯´æ˜Žå½“å‰æ²¡æœ‰å¯ä»¥åŒ¹é…çš„ '('ï¼Œæ›´æ–° start
# å¦‚æžœæ ˆä¸ä¸ºç©ºï¼Œå¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è®¡ç®—å½“å‰æœ‰æ•ˆé•¿åº¦

def longestValidParentheses(s: str) -> int:
    stack = [-1]  # åˆå§‹æ”¾å…¥ -1ï¼Œç”¨äºŽå¤„ç†è¾¹ç•Œæƒ…å†µ
    max_len = 0

    for i, char in enumerate(s):
        if char == '(':
            stack.append(i)
        else:
            stack.pop()
            if not stack:
                stack.append(i)
            else:
                max_len = max(max_len, i - stack[-1])

    return max_len


# ðŸ§  è§£æ³•ä¸‰ï¼šä¸¤æ¬¡éåŽ†ï¼ˆä»Žå·¦åˆ°å³ + ä»Žå³åˆ°å·¦ï¼‰
# ðŸ’¡ æ€è·¯
# ç¬¬ä¸€æ¬¡ä»Žå·¦å¾€å³æ‰«æï¼Œç»Ÿè®¡å·¦å³æ‹¬å·æ•°é‡ï¼Œå½“ left == right æ—¶æ›´æ–°æœ€å¤§å€¼
# ç¬¬äºŒæ¬¡ä»Žå³å¾€å·¦æ‰«æï¼ŒåŒæ ·é€»è¾‘ï¼Œé˜²æ­¢æ¼æŽ‰æŸäº›æƒ…å†µ

def longestValidParentheses(s: str) -> int:
    left = right = max_len = 0

    # ä»Žå·¦åˆ°å³æ‰«æ
    for char in s:
        if char == '(':
            left += 1
        else:
            right += 1
        if left == right:
            max_len = max(max_len, right * 2)
        elif right > left:
            left = right = 0

    left = right = 0

    # ä»Žå³åˆ°å·¦æ‰«æ
    for char in reversed(s):
        if char == '(':
            left += 1
        else:
            right += 1
        if left == right:
            max_len = max(max_len, left * 2)
        elif left > right:
            left = right = 0

    return max_len


