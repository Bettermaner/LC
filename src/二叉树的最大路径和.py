# è·¯å¾„ è¢«å®šä¹‰ä¸ºä¸€æ¡ä»æ ‘ä¸­ä»»æ„èŠ‚ç‚¹å‡ºå‘ï¼Œæ²¿çˆ¶èŠ‚ç‚¹-å­èŠ‚ç‚¹è¿æ¥ï¼Œè¾¾åˆ°ä»»æ„èŠ‚ç‚¹çš„åºåˆ—ã€‚
# åŒä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€æ¡è·¯å¾„åºåˆ—ä¸­ è‡³å¤šå‡ºç°ä¸€æ¬¡ ã€‚è¯¥è·¯å¾„ è‡³å°‘åŒ…å«ä¸€ä¸ª èŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚

# è·¯å¾„å’Œ æ˜¯è·¯å¾„ä¸­å„èŠ‚ç‚¹å€¼çš„æ€»å’Œã€‚

# ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å…¶ æœ€å¤§è·¯å¾„å’Œ 

# è¾“å…¥ï¼šroot = [-10,9,20,null,null,15,7]
# è¾“å‡ºï¼š42
# è§£é‡Šï¼šæœ€ä¼˜è·¯å¾„æ˜¯ 15 -> 20 -> 7 ï¼Œè·¯å¾„å’Œä¸º 15 + 20 + 7 = 42
class obj:

    def __init__(self):
        self.max_value = float('-inf')

    def func(self,root):

        if not root:
            return 0

        # é€’å½’è®¡ç®—å·¦å³å­èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼
        # åªæœ‰åœ¨æœ€å¤§è´¡çŒ®å€¼å¤§äº 0 æ—¶ï¼Œæ‰ä¼šé€‰å–å¯¹åº”å­èŠ‚ç‚¹
        left_gain = max(self.func(root.left),0)
        right_gain = max(self.func(root.right),0)

        #èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„å’Œå–å†³äºè¯¥èŠ‚ç‚¹çš„å€¼ä¸è¯¥èŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼
        path_sum_value = root.val + left_gain + right_gain

        self.max_value = max(path_sum_value,self.max_value)

        # è¿”å›èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼
        return root.val + max(left_gain,right_gain)

    def run(self,root):
        self.func(root)
        return self.max_value
    



# é€šä¹‰å¤§æ¨¡å‹è·‘å‡º

# ğŸ§  è§£é¢˜æ€è·¯
# 1. å…³é”®ç‚¹åˆ†æï¼š
# æ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç»è¿‡ä¸€æ¬¡ã€‚
# è·¯å¾„å¯ä»¥æ˜¯ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„ï¼ˆä¸ä¸€å®šè¿‡æ ¹ï¼‰ã€‚
# æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½æˆä¸ºâ€œæœ€é«˜ç‚¹â€ï¼ˆå³è·¯å¾„åœ¨è¯¥èŠ‚ç‚¹å¤„æ‹å¼¯ï¼‰ã€‚
# 2. å¦‚ä½•ç”¨é€’å½’è§£å†³ï¼Ÿ
# æˆ‘ä»¬ä½¿ç”¨ååºéå†çš„æ–¹å¼ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼š

# è®¡ç®— å·¦å­æ ‘çš„æœ€å¤§è´¡çŒ®å€¼ï¼ˆå¦‚æœå¤§äº0æ‰å–ï¼‰
# è®¡ç®— å³å­æ ‘çš„æœ€å¤§è´¡çŒ®å€¼ï¼ˆå¦‚æœå¤§äº0æ‰å–ï¼‰
# å½“å‰è·¯å¾„çš„æœ€å¤§å€¼ = å½“å‰èŠ‚ç‚¹å€¼ + å·¦å­æ ‘è´¡çŒ® + å³å­æ ‘è´¡çŒ®
# æ›´æ–°å…¨å±€æœ€å¤§è·¯å¾„å’Œ
# è¿”å›å½“å‰èŠ‚ç‚¹èƒ½å‘ä¸Šæä¾›çš„æœ€å¤§è·¯å¾„å’Œï¼šå½“å‰èŠ‚ç‚¹å€¼ + max(å·¦è´¡çŒ®, å³è´¡çŒ®)

# â±ï¸ æ—¶é—´å¤æ‚åº¦ & ç©ºé—´å¤æ‚åº¦
# æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªè®¿é—®ä¸€æ¬¡ã€‚
# ç©ºé—´å¤æ‚åº¦ï¼šO(h)ï¼Œh æ˜¯æ ‘çš„é«˜åº¦ï¼Œé€’å½’æ ˆçš„ç©ºé—´ã€‚

class TreeNode:
    def __init__(self, val=0, left=None, right=None):
        self.val = val
        self.left = left
        self.right = right

class Solution:
    def maxPathSum(self, root: TreeNode) -> int:
        # åˆå§‹åŒ–æœ€å¤§è·¯å¾„å’Œä¸ºè´Ÿæ— ç©·
        self.max_sum = float('-inf')
        
        def gain(node):
            if not node:
                return 0
            
            # é€’å½’è®¡ç®—å·¦å³å­èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼
            left_gain = max(gain(node.left), 0)   # å¦‚æœå°äº0å°±ä¸è¦äº†
            right_gain = max(gain(node.right), 0)
            
            # å½“å‰èŠ‚ç‚¹ä½œä¸ºâ€œæœ€é«˜ç‚¹â€çš„è·¯å¾„å’Œ
            current_max = node.val + left_gain + right_gain
            
            # æ›´æ–°å…¨å±€æœ€å¤§è·¯å¾„å’Œ
            self.max_sum = max(self.max_sum, current_max)
            
            # è¿”å›å½“å‰èŠ‚ç‚¹èƒ½ç»™çˆ¶èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„å’Œ
            return node.val + max(left_gain, right_gain)
        
        gain(root)
        return self.max_sum